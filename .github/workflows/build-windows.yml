name: æ„å»º Windows å¯æ‰§è¡Œæ–‡ä»¶

on:
  push:
    tags:
      - 'v*.*.*'

jobs:
  build:
    runs-on: windows-latest

    steps:
    - name: æ‹‰å–ä»£ç 
      uses: actions/checkout@v4

    - name: é…ç½® MSBuild
      uses: microsoft/setup-msbuild@v2

    - name: ğŸ”¥ å…¨å±€å¼ºåˆ¶UTF-8ç¼–ç ï¼ˆæ ¸å¿ƒï¼‰
      run: |
        # åˆ‡æ¢æ§åˆ¶å°ä»£ç é¡µä¸ºUTF-8
        chcp 65001 > nul
        # è®¾ç½®ç³»ç»Ÿé»˜è®¤ç¼–ç ä¸ºUTF-8
        reg add "HKLM\SYSTEM\CurrentControlSet\Control\Nls\CodePage" /v CP_ACP /t REG_SZ /d 65001 /f
        reg add "HKLM\SYSTEM\CurrentControlSet\Control\Nls\CodePage" /v CP_OEMCP /t REG_SZ /d 65001 /f
        # è®¾ç½®ç³»ç»ŸåŒºåŸŸä¸ºä¸­æ–‡
        reg add "HKCU\Control Panel\International" /v LocaleName /t REG_SZ /d zh-CN /f
        echo "CL=/utf-8" >> $GITHUB_ENV
      shell: cmd

    - name: ç¼–è¯‘é¡¹ç›®ï¼ˆä¿®æ­£MSBuildå‚æ•°ï¼Œä»…ç»™ç¼–è¯‘å™¨ä¼ /utf-8ï¼‰
      run: |
        chcp 65001
        msbuild ./SocialNetwork.sln ^
          /p:Configuration=Release ^
          /p:Platform=x64 ^
          /p:OutDir=./bin/Release ^
          /p:PlatformToolset=v143 ^
          /p:CharacterSet=Unicode ^
          # å…³é”®ï¼šä»…ç»™C++ç¼–è¯‘å™¨ä¼ é€’/utf-8å‚æ•°ï¼Œè€ŒéMSBuild
          /p:CLAdditionalOptions="/utf-8 %(CLAdditionalOptions)" ^
          /p:ForceUTF8=true
      shell: cmd

    - name: ä¸Šä¼  EXE åˆ° Artifacts
      uses: actions/upload-artifact@v4
      with:
        name: windows-exe
        path: ./bin/Release/*.exe

    - name: åˆ›å»º GitHub Release å¹¶ä¸Šä¼  EXE
      uses: softprops/action-gh-release@v2
      with:
        files: ./bin/Release/*.exe
        name: Release ${{ github.ref_name }}
        body: è‡ªåŠ¨æ„å»ºçš„ç‰ˆæœ¬ ${{ github.ref_name }}