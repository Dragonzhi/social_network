name: æ„å»º Windows å¯æ‰§è¡Œæ–‡ä»¶

on:
  push:
    tags:
      - 'v*.*.*'

jobs:
  build:
    runs-on: windows-latest

    steps:
    - name: æ‹‰å–ä»£ç 
      uses: actions/checkout@v4

    - name: é…ç½® MSBuild
      uses: microsoft/setup-msbuild@v2

    - name: ğŸ”¥ å…¨å±€å¼ºåˆ¶UTF-8ç¼–ç ï¼ˆå…³é”®ï¼šè§£å†³ä»£ç é¡µ1252é—®é¢˜ï¼‰
      run: |
        # 1. åˆ‡æ¢æ§åˆ¶å°ä»£ç é¡µä¸ºUTF-8ï¼ˆ65001ï¼‰
        chcp 65001 > nul
        # 2. è®¾ç½®ç³»ç»Ÿé»˜è®¤ç¼–ç ä¸ºUTF-8ï¼ˆæ°¸ä¹…ç”Ÿæ•ˆï¼‰
        reg add "HKLM\SYSTEM\CurrentControlSet\Control\Nls\CodePage" /v CP_ACP /t REG_SZ /d 65001 /f
        reg add "HKLM\SYSTEM\CurrentControlSet\Control\Nls\CodePage" /v CP_OEMCP /t REG_SZ /d 65001 /f
        # 3. è®¾ç½®ç³»ç»ŸåŒºåŸŸä¸ºä¸­æ–‡ï¼ˆé¿å…è¯­è¨€åŒ…ç¼ºå¤±ï¼‰
        reg add "HKCU\Control Panel\International" /v LocaleName /t REG_SZ /d zh-CN /f
        reg add "HKLM\SYSTEM\CurrentControlSet\Control\Nls\Language" /v Default /t REG_SZ /d 0804 /f

    - name: å®‰è£…ä¸­æ–‡è¯­è¨€åŒ…å’Œå­—ä½“ï¼ˆå…œåº•UIæ˜¾ç¤ºï¼‰
      run: |
        dism /online /enable-feature /featurename:LanguageFeatures-Chinese-Simplified /all /quiet /norestart
        choco install -y chinese-simplified-fonts --no-progress --limit-output

    - name: ç¼–è¯‘é¡¹ç›®ï¼ˆå¼ºåˆ¶UTF-8è§£ææºç +Unicodeå­—ç¬¦é›†ï¼‰
      run: |
        # æ ¸å¿ƒå‚æ•°ï¼š/utf-8 è®©MSVCä»¥UTF-8è§£ææ‰€æœ‰æºç ï¼ˆæ— éœ€æ”¹ä¸­æ–‡ä»£ç ï¼‰
        msbuild ./SocialNetwork.sln `
          /p:Configuration=Release `
          /p:Platform=x64 `
          /p:OutDir=./bin/Release `
          /p:PlatformToolset=v143 `
          /p:CharacterSet=Unicode `          # å¼ºåˆ¶Unicodeå­—ç¬¦é›†
          /p:ForceUTF8=true `                # å…œåº•ï¼šå¼ºåˆ¶UTF-8
          /utf-8 `                           # MSBuildä»¥UTF-8è¯»å–é¡¹ç›®æ–‡ä»¶
          /p:AdditionalOptions="/utf-8 %(AdditionalOptions)"  # ç¼–è¯‘å™¨ä»¥UTF-8è§£ææºç 

    - name: ä¸Šä¼  EXE åˆ° Artifacts
      uses: actions/upload-artifact@v4
      with:
        name: windows-exe
        path: ./bin/Release/*.exe

    - name: åˆ›å»º GitHub Release å¹¶ä¸Šä¼  EXE
      uses: softprops/action-gh-release@v2
      with:
        files: ./bin/Release/*.exe
        name: Release ${{ github.ref_name }}
        body: è‡ªåŠ¨æ„å»ºçš„ç‰ˆæœ¬ ${{ github.ref_name }}